<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Hasil Survey Monev - SEO Specialist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563EB',
                        secondary: '#475569',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 text-slate-800 font-sans h-screen flex overflow-hidden">

    <!-- SIDEBAR (Simplified) -->
    <aside class="w-64 bg-gray-900 text-gray-300 flex flex-col shadow-xl z-20 hidden md:flex">
        <div class="h-16 flex items-center px-6 bg-gray-950 text-white font-bold text-xl tracking-wider border-b border-gray-800">
            <i class="fa-solid fa-layer-group text-amber-500 mr-2"></i> SIM-LAT
        </div>
        <nav class="flex-1 px-2 py-4 space-y-2">
            <a href="detail-kelas.html" class="flex items-center px-4 py-2.5 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors">
                <i class="fa-solid fa-arrow-left w-6 text-center mr-2"></i>
                <span class="font-medium">Kembali ke Kelas</span>
            </a>
            <div class="px-4 py-2 text-xs font-semibold text-gray-600 uppercase tracking-wider mt-4">Laporan Survey</div>
            <a href="#" class="flex items-center px-4 py-2 rounded-lg bg-gray-800 text-white shadow-sm border-l-4 border-amber-500">
                <i class="fa-solid fa-chart-pie w-6 text-center mr-2 text-amber-500"></i>
                <span>Analisis Lengkap</span>
            </a>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50">

        <!-- Header -->
        <header class="bg-white shadow-sm h-16 flex items-center justify-between px-8 sticky top-0 z-30">
            <div class="flex items-center gap-4">
                <a href="detail-kelas.html" class="md:hidden text-gray-500 hover:text-gray-800"><i class="fa-solid fa-arrow-left text-xl"></i></a>
                <div>
                    <h1 class="text-xl font-bold text-gray-800">Analisis Hasil Survey Monev</h1>
                    <p class="text-xs text-gray-500">Pelatihan: SEO Specialist & Analytics â€¢ Batch 5</p>
                </div>
            </div>
            <div class="flex gap-3">
                <button class="bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 shadow-sm transition-colors">
                   <i class="fa-solid fa-filter"></i> Filter Data
                </button>
                <button class="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 shadow-sm transition-colors">
                    <i class="fa-solid fa-download"></i> Download Report
                </button>
            </div>
        </header>

        <div class="p-8 max-w-7xl mx-auto space-y-8">

            <!-- LEVEL 1: AKUMULASI TOTAL (DASHBOARD RINGKASAN) -->
            <section>
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">1</span>
                    Akumulasi Total (Indeks Kepuasan)
                </h2>
                
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                    <!-- Skor Utama -->
                    <div class="text-center md:text-left border-b md:border-b-0 md:border-r border-gray-100 pb-6 md:pb-0">
                        <p class="text-sm text-gray-500 mb-1">Indeks Kepuasan Rata-rata (IKM)</p>
                        <div class="flex items-end justify-center md:justify-start gap-2">
                            <span class="text-5xl font-bold text-gray-900">88.45</span>
                            <span class="text-lg text-gray-400 font-medium mb-1">/ 100</span>
                        </div>
                        <div class="mt-3 inline-block bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-bold">
                            Kategori: SANGAT BAIK
                        </div>
                    </div>

                    <!-- Distribusi Jawaban (Doughnut Kecil) -->
                    <div class="flex items-center gap-4 col-span-2">
                        <div class="h-32 w-32 relative shrink-0">
                            <canvas id="chartTotalAccumulation"></canvas>
                        </div>
                        <div class="flex-1 grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-xs text-gray-500">Sangat Memuaskan</div>
                                <div class="font-bold text-lg text-gray-800">65%</div>
                                <div class="w-full bg-gray-100 h-1.5 rounded-full mt-1"><div class="bg-green-500 h-1.5 rounded-full" style="width: 65%"></div></div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">Memuaskan</div>
                                <div class="font-bold text-lg text-gray-800">25%</div>
                                <div class="w-full bg-gray-100 h-1.5 rounded-full mt-1"><div class="bg-blue-500 h-1.5 rounded-full" style="width: 25%"></div></div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">Kurang Memuaskan</div>
                                <div class="font-bold text-lg text-gray-800">8%</div>
                                <div class="w-full bg-gray-100 h-1.5 rounded-full mt-1"><div class="bg-yellow-500 h-1.5 rounded-full" style="width: 8%"></div></div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">Tidak Memuaskan</div>
                                <div class="font-bold text-lg text-gray-800">2%</div>
                                <div class="w-full bg-gray-100 h-1.5 rounded-full mt-1"><div class="bg-red-500 h-1.5 rounded-full" style="width: 2%"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- LEVEL 2: ANALISIS PER KATEGORI -->
            <section>
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">2</span>
                    Performa Per Kategori
                </h2>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <div class="h-72">
                        <canvas id="chartCategories"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-4 text-center italic">*Grafik menunjukkan nilai rata-rata (Skala 1-4) untuk setiap grup kategori pertanyaan.</p>
                </div>
            </section>

            <!-- LEVEL 3: DETAIL PER PERTANYAAN (DYNAMIC RENDER FROM DB DATA) -->
            <section class="space-y-8" id="questions-container">
                <h2 class="text-lg font-bold text-gray-800 flex items-center">
                    <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">3</span>
                    Detail Jawaban Per Pertanyaan (Q1 - Q33)
                </h2>
                <!-- Container ini akan diisi otomatis oleh JavaScript berdasarkan grouping kategori database -->
            </section>

        </div>
    </main>

    <script>
        // --- 1. SIMULASI DATA DARI DATABASE (SELECT * FROM pertanyaan ...) ---
        // Anggap ini adalah hasil fetch API dari backend Anda.
        // Kolom 'kategori' adalah kunci untuk pengelompokan.
        const dbQuestions = [
            // Kategori: Pelayanan & Petugas
            { id: 1, nomor: 'Q1', teks_pertanyaan: 'Kesesuaian jenis pelayanan dengan penyelenggaraannya', kategori: 'Pelayanan & Petugas' },
            { id: 2, nomor: 'Q2', teks_pertanyaan: 'Kemudahan prosedur pelayanan penyelenggaraan pelatihan', kategori: 'Pelayanan & Petugas' },
            { id: 3, nomor: 'Q3', teks_pertanyaan: 'Kedisiplinan petugas/panitia dalam pelayanan', kategori: 'Pelayanan & Petugas' },
            { id: 4, nomor: 'Q4', teks_pertanyaan: 'Kesopanan dan keramahan petugas penyelenggara', kategori: 'Pelayanan & Petugas' },
            { id: 5, nomor: 'Q5', teks_pertanyaan: 'Pelayanan petugas bengkel', kategori: 'Pelayanan & Petugas' },
            { id: 6, nomor: 'Q6', teks_pertanyaan: 'Pelayanan petugas asrama', kategori: 'Pelayanan & Petugas' },
            { id: 7, nomor: 'Q7', teks_pertanyaan: 'Pelayanan petugas konsumsi', kategori: 'Pelayanan & Petugas' },
            { id: 15, nomor: 'Q15', teks_pertanyaan: 'Keamanan pelayanan di instansi ini', kategori: 'Pelayanan & Petugas' },
            { id: 16, nomor: 'Q16', teks_pertanyaan: 'Kecukupan waktu penyelenggaraan pelatihan', kategori: 'Pelayanan & Petugas' },

            // Kategori: Sarana & Prasarana
            { id: 8, nomor: 'Q8', teks_pertanyaan: 'Ketersediaan Sarana dan Prasarana di instansi', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 9, nomor: 'Q9', teks_pertanyaan: 'Kebersihan tempat ibadah (mushola)', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 10, nomor: 'Q10', teks_pertanyaan: 'Kebersihan asrama / lingkungan asrama', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 11, nomor: 'Q11', teks_pertanyaan: 'Kebersihan kamar mandi / lingkungan toilet', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 12, nomor: 'Q12', teks_pertanyaan: 'Kebersihan lingkungan taman dan halaman', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 13, nomor: 'Q13', teks_pertanyaan: 'Kebersihan bengkel / kelas / lingkungan kelas', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 14, nomor: 'Q14', teks_pertanyaan: 'Kebersihan ruang makan / lingkungan makan', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 18, nomor: 'Q18', teks_pertanyaan: 'Ketersediaan bahan-bahan praktek', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 19, nomor: 'Q19', teks_pertanyaan: 'Ketersediaan mesin/peralatan untuk pelatihan', kategori: 'Sarana, Prasarana & Kebersihan' },
            { id: 20, nomor: 'Q20', teks_pertanyaan: 'Kondisi mesin/peralatan pelatihan', kategori: 'Sarana, Prasarana & Kebersihan' },

            // Kategori: Materi Pelatihan
            { id: 17, nomor: 'Q17', teks_pertanyaan: 'Manfaat pelatihan bagi Anda', kategori: 'Materi & Kurikulum' },
            { id: 21, nomor: 'Q21', teks_pertanyaan: 'Ketersediaan materi pelatihan', kategori: 'Materi & Kurikulum' },
            { id: 22, nomor: 'Q22', teks_pertanyaan: 'Persentase penyerapan materi oleh Anda', kategori: 'Materi & Kurikulum' },
            { id: 23, nomor: 'Q23', teks_pertanyaan: 'Perlu penambahan materi pelatihan', kategori: 'Materi & Kurikulum' },
            { id: 24, nomor: 'Q24', teks_pertanyaan: 'Perlu pengurangan materi pelatihan', kategori: 'Materi & Kurikulum' },
            { id: 25, nomor: 'Q25', teks_pertanyaan: 'Dukungan materi terhadap kompetensi Anda', kategori: 'Materi & Kurikulum' },

            // Kategori: Kinerja Instruktur
            { id: 26, nomor: 'Q26', teks_pertanyaan: 'Penguasaan materi/kompetensi Instruktur', kategori: 'Kinerja Instruktur' },
            { id: 27, nomor: 'Q27', teks_pertanyaan: 'Kedisiplinan/ketepatan waktu Instruktur', kategori: 'Kinerja Instruktur' },
            { id: 28, nomor: 'Q28', teks_pertanyaan: 'Metode mengajar Instruktur', kategori: 'Kinerja Instruktur' },
            { id: 29, nomor: 'Q29', teks_pertanyaan: 'Sikap dan perilaku Instruktur saat mengajar', kategori: 'Kinerja Instruktur' },
            { id: 30, nomor: 'Q30', teks_pertanyaan: 'Kerapian berpakaian Instruktur', kategori: 'Kinerja Instruktur' },
            { id: 31, nomor: 'Q31', teks_pertanyaan: 'Penggunaan bahasa oleh Instruktur', kategori: 'Kinerja Instruktur' },
            { id: 32, nomor: 'Q32', teks_pertanyaan: 'Instruktur memberikan motivasi pada peserta', kategori: 'Kinerja Instruktur' },
            { id: 33, nomor: 'Q33', teks_pertanyaan: 'Cara Instruktur menjawab pertanyaan peserta', kategori: 'Kinerja Instruktur' }
        ];

        // --- 2. LOGIKA PENGELOMPOKAN DATA (GROUP BY CATEGORY) ---
        // Fungsi ini mengubah flat array dari DB menjadi object terkelompok
        function groupQuestionsByCategory(questions) {
            return questions.reduce((groups, question) => {
                const category = question.kategori || 'Lainnya';
                if (!groups[category]) {
                    groups[category] = [];
                }
                groups[category].push(question);
                return groups;
            }, {});
        }

        const groupedQuestions = groupQuestionsByCategory(dbQuestions);

        // --- 3. RENDER UI DINAMIS BERDASARKAN GRUP ---
        const mainContainer = document.getElementById('questions-container');
        
        // Urutan Kategori yang diinginkan (Opsional, agar urutannya konsisten)
        const categoryOrder = [
            'Pelayanan & Petugas',
            'Sarana, Prasarana & Kebersihan',
            'Materi & Kurikulum',
            'Kinerja Instruktur'
        ];

        // --- KONFIGURASI CHART ---
        const colors = {
            sangat_puas: '#10B981', // Hijau
            puas: '#3B82F6',        // Biru
            kurang: '#F59E0B',      // Kuning
            tidak: '#EF4444'        // Merah
        };
        const pieLabels = ['Sangat Memuaskan', 'Memuaskan', 'Kurang Memuaskan', 'Tidak Memuaskan'];
        const pieColors = [colors.sangat_puas, colors.puas, colors.kurang, colors.tidak];

        // Loop setiap kategori dan buat section HTML nya
        categoryOrder.forEach((categoryName, index) => {
            const questions = groupedQuestions[categoryName];
            if (!questions) return; // Skip jika kategori tidak ada datanya

            // Buat Wrapper Kategori
            const categoryWrapper = document.createElement('div');
            categoryWrapper.className = 'bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-8';
            
            // Header Kategori
            // Menggunakan Huruf (A, B, C...) berdasarkan index
            const sectionLetter = String.fromCharCode(65 + index); 
            categoryWrapper.innerHTML = `
                <div class="bg-gray-50 px-6 py-3 border-b border-gray-200">
                    <h3 class="font-bold text-gray-700 text-sm uppercase tracking-wider">${sectionLetter}. ${categoryName}</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="grid-${index}">
                    <!-- Chart items will be injected here -->
                </div>
            `;
            mainContainer.appendChild(categoryWrapper);

            // Render Chart untuk setiap pertanyaan di kategori ini
            const gridContainer = document.getElementById(`grid-${index}`);
            
            questions.forEach(q => {
                // 1. Buat Elemen HTML Pertanyaan
                const div = document.createElement('div');
                div.className = 'flex flex-col items-center';
                div.innerHTML = `
                    <h4 class="text-sm font-semibold text-gray-800 mb-3 text-center h-12 flex items-center justify-center w-full px-2 leading-tight">
                        <span class="mr-1 text-primary font-bold">${q.nomor}.</span> ${q.teks_pertanyaan}
                    </h4>
                    <div class="h-48 w-full relative">
                        <canvas id="chart-${q.id}"></canvas>
                    </div>
                `;
                gridContainer.appendChild(div);

                // 2. Render Chart dengan Data Dummy (Karena data jawaban belum ada di snippet ini)
                // Di real app, Anda akan query tabel `jawaban_user` -> join `opsi_jawaban` -> hitung count
                const val1 = Math.floor(Math.random() * (80 - 50) + 50); 
                const val2 = Math.floor(Math.random() * (30 - 10) + 10); 
                const val3 = 100 - val1 - val2;

                new Chart(document.getElementById(`chart-${q.id}`).getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: pieLabels,
                        datasets: [{
                            data: [val1, val2, val3, 0],
                            backgroundColor: pieColors,
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { boxWidth: 10, font: { size: 10 }, padding: 10 }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.raw + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            });
        });


        // --- LEVEL 1 & 2 CHART (STATIC UTK CONTOH) ---
        const ctxTotal = document.getElementById('chartTotalAccumulation').getContext('2d');
        new Chart(ctxTotal, {
            type: 'doughnut',
            data: {
                labels: pieLabels,
                datasets: [{
                    data: [65, 25, 8, 2],
                    backgroundColor: pieColors,
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: { legend: { display: false } }
            }
        });

        const ctxCat = document.getElementById('chartCategories').getContext('2d');
        new Chart(ctxCat, {
            type: 'bar',
            data: {
                labels: categoryOrder,
                datasets: [{
                    label: 'Nilai Rata-rata (Maks 4.0)',
                    data: [3.4, 3.2, 3.6, 3.8],
                    backgroundColor: ['#60A5FA', '#FBBF24', '#A78BFA', '#34D399'],
                    borderRadius: 6,
                    barThickness: 40
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 4.0,
                        grid: { color: '#f3f4f6' }
                    },
                    y: {
                        grid: { display: false }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });

    </script>
</body>
</html>